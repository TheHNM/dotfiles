<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Rewrite internet and battery scripts - dotfiles - Unnamed repository; edit this file &#39;description&#39; to name the repository.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dotfiles Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>dotfiles</h1><span class="desc">Unnamed repository; edit this file &#39;description&#39; to name the repository.
</span></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/60681e758dbf398a66349cc118e4e4f1b157c528.html">60681e758dbf398a66349cc118e4e4f1b157c528</a>
<b>parent</b> <a href="../commit/58c0a7fe9241600d61d45c350bc79393fc780ee0.html">58c0a7fe9241600d61d45c350bc79393fc780ee0</a>
<b>Author:</b> thehnm &lt;<a href="mailto:hngnm@pm.me">hngnm@pm.me</a>&gt;
<b>Date:</b>   Wed, 22 May 2019 15:02:10 +0200

Rewrite internet and battery scripts

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">config.stow/.config/i3/i3blocks.conf</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">config.stow/.config/i3/scripts/battery</a></td><td> | </td><td class="num">80</td><td><span class="i">++++++++++</span><span class="d">---------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h2">config.stow/.config/i3/scripts/ethernet</a></td><td> | </td><td class="num">6</td><td><span class="i">++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h3">config.stow/.config/i3/scripts/iface</a></td><td> | </td><td class="num">61</td><td><span class="i"></span><span class="d">-------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">config.stow/.config/i3/scripts/wifi</a></td><td> | </td><td class="num">6</td><td><span class="i">++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">config.stow/.profile</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
</table></pre><pre>6 files changed, 31 insertions(+), 133 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.stow/.config/i3/i3blocks.conf.html">config.stow/.config/i3/i3blocks.conf</a> b/<a href="../file/config.stow/.config/i3/i3blocks.conf.html">config.stow/.config/i3/i3blocks.conf</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -55,13 +55,19 @@ label=[light]
</a> interval=1
 color=#f0c674
 
<a href="#h0-0-3" id="h0-0-3" class="d">-[iface]
</a><a href="#h0-0-4" id="h0-0-4" class="d">-label=[ip]
</a><a href="#h0-0-5" id="h0-0-5" class="i">+[wifi]
</a><a href="#h0-0-6" id="h0-0-6" class="i">+label=[wifi]
</a><a href="#h0-0-7" id="h0-0-7" class="i">+interval=1
</a><a href="#h0-0-8" id="h0-0-8" class="i">+color=#8abeb7
</a><a href="#h0-0-9" id="h0-0-9" class="i">+
</a><a href="#h0-0-10" id="h0-0-10" class="i">+[ethernet]
</a><a href="#h0-0-11" id="h0-0-11" class="i">+label=[eth]
</a> interval=1
 color=#8abeb7
 
 [battery]
 label=[bat]
<a href="#h0-0-17" id="h0-0-17" class="i">+command=$HOME/.config/i3/scripts/battery BAT0
</a> interval=1
 color=#de935f
 
<b>diff --git a/<a id="h1" href="../file/config.stow/.config/i3/scripts/battery.html">config.stow/.config/i3/scripts/battery</a> b/<a href="../file/config.stow/.config/i3/scripts/battery.html">config.stow/.config/i3/scripts/battery</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,74 +1,14 @@
</a><a href="#h1-0-0" id="h1-0-0" class="d">-#!/usr/bin/perl
</a><a href="#h1-0-1" id="h1-0-1" class="d">-#
</a><a href="#h1-0-2" id="h1-0-2" class="d">-# Copyright 2014 Pierre Mavro &lt;deimos@deimos.fr&gt;
</a><a href="#h1-0-3" id="h1-0-3" class="d">-# Copyright 2014 Vivien Didelot &lt;vivien@didelot.org&gt;
</a><a href="#h1-0-4" id="h1-0-4" class="d">-#
</a><a href="#h1-0-5" id="h1-0-5" class="d">-# Licensed under the terms of the GNU GPL v3, or any later version.
</a><a href="#h1-0-6" id="h1-0-6" class="d">-#
</a><a href="#h1-0-7" id="h1-0-7" class="d">-# This script is meant to use with i3blocks. It parses the output of the &quot;acpi&quot;
</a><a href="#h1-0-8" id="h1-0-8" class="d">-# command (often provided by a package of the same name) to read the status of
</a><a href="#h1-0-9" id="h1-0-9" class="d">-# the battery, and eventually its remaining time (to full charge or discharge).
</a><a href="#h1-0-10" id="h1-0-10" class="d">-#
</a><a href="#h1-0-11" id="h1-0-11" class="d">-# The color will gradually change for a percentage below 85%, and the urgency
</a><a href="#h1-0-12" id="h1-0-12" class="d">-# (exit code 33) is set if there is less that 5% remaining.
</a><a href="#h1-0-13" id="h1-0-13" class="i">+#!/bin/sh
</a> 
<a href="#h1-0-15" id="h1-0-15" class="d">-use strict;
</a><a href="#h1-0-16" id="h1-0-16" class="d">-use warnings;
</a><a href="#h1-0-17" id="h1-0-17" class="d">-use utf8;
</a><a href="#h1-0-18" id="h1-0-18" class="i">+capacity=$(cat /sys/class/power_supply/&quot;$1&quot;/capacity) || exit
</a><a href="#h1-0-19" id="h1-0-19" class="i">+status=$(cat /sys/class/power_supply/&quot;$1&quot;/status)
</a> 
<a href="#h1-0-21" id="h1-0-21" class="d">-my $acpi;
</a><a href="#h1-0-22" id="h1-0-22" class="d">-my $status;
</a><a href="#h1-0-23" id="h1-0-23" class="d">-my $percent;
</a><a href="#h1-0-24" id="h1-0-24" class="d">-my $full_text;
</a><a href="#h1-0-25" id="h1-0-25" class="d">-my $short_text;
</a><a href="#h1-0-26" id="h1-0-26" class="d">-my $bat_number = $ENV{BLOCK_INSTANCE} || 0;
</a><a href="#h1-0-27" id="h1-0-27" class="i">+if [ &quot;$capacity&quot; -ge 50 ]; then
</a><a href="#h1-0-28" id="h1-0-28" class="i">+	color=&quot;#de935f&quot;
</a><a href="#h1-0-29" id="h1-0-29" class="i">+else
</a><a href="#h1-0-30" id="h1-0-30" class="i">+	color=&quot;#cc6666&quot;
</a><a href="#h1-0-31" id="h1-0-31" class="i">+fi
</a> 
<a href="#h1-0-33" id="h1-0-33" class="d">-# read the first line of the &quot;acpi&quot; command output
</a><a href="#h1-0-34" id="h1-0-34" class="d">-open (ACPI, &quot;acpi -b | grep &#39;Battery $bat_number&#39; |&quot;) or die;
</a><a href="#h1-0-35" id="h1-0-35" class="d">-$acpi = &lt;ACPI&gt;;
</a><a href="#h1-0-36" id="h1-0-36" class="d">-close(ACPI);
</a><a href="#h1-0-37" id="h1-0-37" class="i">+[ &quot;$status&quot; = &quot;Charging&quot; ] &amp;&amp; color=&quot;#8c9440&quot;
</a> 
<a href="#h1-0-39" id="h1-0-39" class="d">-# fail on unexpected output
</a><a href="#h1-0-40" id="h1-0-40" class="d">-if ($acpi !~ /: (\w+), (\d+)%/) {
</a><a href="#h1-0-41" id="h1-0-41" class="d">-	die &quot;$acpi\n&quot;;
</a><a href="#h1-0-42" id="h1-0-42" class="d">-}
</a><a href="#h1-0-43" id="h1-0-43" class="d">-
</a><a href="#h1-0-44" id="h1-0-44" class="d">-$status = $1;
</a><a href="#h1-0-45" id="h1-0-45" class="d">-$percent = $2;
</a><a href="#h1-0-46" id="h1-0-46" class="d">-$full_text = &quot;$percent%&quot;;
</a><a href="#h1-0-47" id="h1-0-47" class="d">-
</a><a href="#h1-0-48" id="h1-0-48" class="d">-if ($status eq &#39;Discharging&#39;) {
</a><a href="#h1-0-49" id="h1-0-49" class="d">-	$full_text .= &#39; dis&#39;;
</a><a href="#h1-0-50" id="h1-0-50" class="d">-} elsif ($status eq &#39;Charging&#39;) {
</a><a href="#h1-0-51" id="h1-0-51" class="d">-	$full_text .= &#39; chr&#39;;
</a><a href="#h1-0-52" id="h1-0-52" class="d">-}
</a><a href="#h1-0-53" id="h1-0-53" class="d">-
</a><a href="#h1-0-54" id="h1-0-54" class="d">-$short_text = $full_text;
</a><a href="#h1-0-55" id="h1-0-55" class="d">-
</a><a href="#h1-0-56" id="h1-0-56" class="d">-if ($acpi =~ /(\d\d:\d\d):/) {
</a><a href="#h1-0-57" id="h1-0-57" class="d">-	$full_text .= &quot; ($1)&quot;;
</a><a href="#h1-0-58" id="h1-0-58" class="d">-}
</a><a href="#h1-0-59" id="h1-0-59" class="d">-
</a><a href="#h1-0-60" id="h1-0-60" class="d">-# print text
</a><a href="#h1-0-61" id="h1-0-61" class="d">-print &quot;$full_text\n&quot;;
</a><a href="#h1-0-62" id="h1-0-62" class="d">-print &quot;$short_text\n&quot;;
</a><a href="#h1-0-63" id="h1-0-63" class="d">-
</a><a href="#h1-0-64" id="h1-0-64" class="d">-# consider color and urgent flag only on discharge
</a><a href="#h1-0-65" id="h1-0-65" class="d">-if ($status eq &#39;Discharging&#39;) {
</a><a href="#h1-0-66" id="h1-0-66" class="d">-
</a><a href="#h1-0-67" id="h1-0-67" class="d">-	if ($percent &lt; 20) {
</a><a href="#h1-0-68" id="h1-0-68" class="d">-		print &quot;#FF0000\n&quot;;
</a><a href="#h1-0-69" id="h1-0-69" class="d">-	} elsif ($percent &lt; 40) {
</a><a href="#h1-0-70" id="h1-0-70" class="d">-		print &quot;#FFAE00\n&quot;;
</a><a href="#h1-0-71" id="h1-0-71" class="d">-	} elsif ($percent &lt; 60) {
</a><a href="#h1-0-72" id="h1-0-72" class="d">-		print &quot;#FFF600\n&quot;;
</a><a href="#h1-0-73" id="h1-0-73" class="d">-	} elsif ($percent &lt; 85) {
</a><a href="#h1-0-74" id="h1-0-74" class="d">-		print &quot;#A8FF00\n&quot;;
</a><a href="#h1-0-75" id="h1-0-75" class="d">-	}
</a><a href="#h1-0-76" id="h1-0-76" class="d">-
</a><a href="#h1-0-77" id="h1-0-77" class="d">-	if ($percent &lt; 5) {
</a><a href="#h1-0-78" id="h1-0-78" class="d">-		exit(33);
</a><a href="#h1-0-79" id="h1-0-79" class="d">-	}
</a><a href="#h1-0-80" id="h1-0-80" class="d">-}
</a><a href="#h1-0-81" id="h1-0-81" class="d">-
</a><a href="#h1-0-82" id="h1-0-82" class="d">-exit(0);
</a><a href="#h1-0-83" id="h1-0-83" class="i">+echo &quot;&lt;span color=&#39;$color&#39;&gt;$status $capacity%&lt;/span&gt;&quot; | sed -e &quot;s/Discharging/dis/g;s/Charging/chr/g&quot;
</a><b>diff --git a/<a id="h2" href="../file/config.stow/.config/i3/scripts/ethernet.html">config.stow/.config/i3/scripts/ethernet</a> b/<a href="../file/config.stow/.config/i3/scripts/ethernet.html">config.stow/.config/i3/scripts/ethernet</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1,6 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+#!/bin/sh
</a><a href="#h2-0-1" id="h2-0-1" class="i">+
</a><a href="#h2-0-2" id="h2-0-2" class="i">+carrierstate=$(cat /sys/class/net/e*/carrier)
</a><a href="#h2-0-3" id="h2-0-3" class="i">+[ &quot;$carrierstate&quot; = &quot;0&quot; ] &amp;&amp; exit
</a><a href="#h2-0-4" id="h2-0-4" class="i">+
</a><a href="#h2-0-5" id="h2-0-5" class="i">+echo &quot;Connected&quot;
</a><b>diff --git a/<a id="h3" href="../file/config.stow/.config/i3/scripts/iface.html">config.stow/.config/i3/scripts/iface</a> b/<a href="../file/config.stow/.config/i3/scripts/iface.html">config.stow/.config/i3/scripts/iface</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,61 +0,0 @@
</a><a href="#h3-0-0" id="h3-0-0" class="d">-#!/bin/sh
</a><a href="#h3-0-1" id="h3-0-1" class="d">-# Copyright (C) 2014 Julien Bonjean &lt;julien@bonjean.info&gt;
</a><a href="#h3-0-2" id="h3-0-2" class="d">-# Copyright (C) 2014 Alexander Keller &lt;github@nycroth.com&gt;
</a><a href="#h3-0-3" id="h3-0-3" class="d">-
</a><a href="#h3-0-4" id="h3-0-4" class="d">-# This program is free software: you can redistribute it and/or modify
</a><a href="#h3-0-5" id="h3-0-5" class="d">-# it under the terms of the GNU General Public License as published by
</a><a href="#h3-0-6" id="h3-0-6" class="d">-# the Free Software Foundation, either version 3 of the License, or
</a><a href="#h3-0-7" id="h3-0-7" class="d">-# (at your option) any later version.
</a><a href="#h3-0-8" id="h3-0-8" class="d">-
</a><a href="#h3-0-9" id="h3-0-9" class="d">-# This program is distributed in the hope that it will be useful,
</a><a href="#h3-0-10" id="h3-0-10" class="d">-# but WITHOUT ANY WARRANTY; without even the implied warranty of
</a><a href="#h3-0-11" id="h3-0-11" class="d">-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
</a><a href="#h3-0-12" id="h3-0-12" class="d">-# GNU General Public License for more details.
</a><a href="#h3-0-13" id="h3-0-13" class="d">-
</a><a href="#h3-0-14" id="h3-0-14" class="d">-# You should have received a copy of the GNU General Public License
</a><a href="#h3-0-15" id="h3-0-15" class="d">-# along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
</a><a href="#h3-0-16" id="h3-0-16" class="d">-
</a><a href="#h3-0-17" id="h3-0-17" class="d">-#------------------------------------------------------------------------
</a><a href="#h3-0-18" id="h3-0-18" class="d">-
</a><a href="#h3-0-19" id="h3-0-19" class="d">-# Use the provided interface, otherwise the device used for the default route.
</a><a href="#h3-0-20" id="h3-0-20" class="d">-if [[ -n $BLOCK_INSTANCE ]]; then
</a><a href="#h3-0-21" id="h3-0-21" class="d">-  IF=$BLOCK_INSTANCE
</a><a href="#h3-0-22" id="h3-0-22" class="d">-else
</a><a href="#h3-0-23" id="h3-0-23" class="d">-  IF=$(ip route | awk &#39;/^default/ { print $5 ; exit }&#39;)
</a><a href="#h3-0-24" id="h3-0-24" class="d">-fi
</a><a href="#h3-0-25" id="h3-0-25" class="d">-
</a><a href="#h3-0-26" id="h3-0-26" class="d">-#------------------------------------------------------------------------
</a><a href="#h3-0-27" id="h3-0-27" class="d">-
</a><a href="#h3-0-28" id="h3-0-28" class="d">-# As per #36 -- It is transparent: e.g. if the machine has no battery or wireless
</a><a href="#h3-0-29" id="h3-0-29" class="d">-# connection (think desktop), the corresponding block should not be displayed.
</a><a href="#h3-0-30" id="h3-0-30" class="d">-[[ ! -d /sys/class/net/${IF} ]] &amp;&amp; exit
</a><a href="#h3-0-31" id="h3-0-31" class="d">-
</a><a href="#h3-0-32" id="h3-0-32" class="d">-#------------------------------------------------------------------------
</a><a href="#h3-0-33" id="h3-0-33" class="d">-
</a><a href="#h3-0-34" id="h3-0-34" class="d">-if [[ &quot;$(cat /sys/class/net/$IF/operstate)&quot; = &#39;down&#39; ]]; then
</a><a href="#h3-0-35" id="h3-0-35" class="d">-  echo down # full text
</a><a href="#h3-0-36" id="h3-0-36" class="d">-  echo down # short text
</a><a href="#h3-0-37" id="h3-0-37" class="d">-  echo \#FF0000 # color
</a><a href="#h3-0-38" id="h3-0-38" class="d">-  exit
</a><a href="#h3-0-39" id="h3-0-39" class="d">-fi
</a><a href="#h3-0-40" id="h3-0-40" class="d">-
</a><a href="#h3-0-41" id="h3-0-41" class="d">-case $1 in
</a><a href="#h3-0-42" id="h3-0-42" class="d">-  -4)
</a><a href="#h3-0-43" id="h3-0-43" class="d">-    AF=inet ;;
</a><a href="#h3-0-44" id="h3-0-44" class="d">-  -6)
</a><a href="#h3-0-45" id="h3-0-45" class="d">-    AF=inet6 ;;
</a><a href="#h3-0-46" id="h3-0-46" class="d">-  *)
</a><a href="#h3-0-47" id="h3-0-47" class="d">-    AF=inet6? ;;
</a><a href="#h3-0-48" id="h3-0-48" class="d">-esac
</a><a href="#h3-0-49" id="h3-0-49" class="d">-
</a><a href="#h3-0-50" id="h3-0-50" class="d">-# if no interface is found, use the first device with a global scope
</a><a href="#h3-0-51" id="h3-0-51" class="d">-IPADDR=$(ip addr show $IF | perl -n -e &quot;/$AF ([^\/]+).* scope global/ &amp;&amp; print \$1 and exit&quot;)
</a><a href="#h3-0-52" id="h3-0-52" class="d">-
</a><a href="#h3-0-53" id="h3-0-53" class="d">-case $BLOCK_BUTTON in
</a><a href="#h3-0-54" id="h3-0-54" class="d">-  3) echo -n &quot;$IPADDR&quot; | xclip -q -se c ;;
</a><a href="#h3-0-55" id="h3-0-55" class="d">-esac
</a><a href="#h3-0-56" id="h3-0-56" class="d">-
</a><a href="#h3-0-57" id="h3-0-57" class="d">-#------------------------------------------------------------------------
</a><a href="#h3-0-58" id="h3-0-58" class="d">-
</a><a href="#h3-0-59" id="h3-0-59" class="d">-echo &quot;$IPADDR&quot; # full text
</a><a href="#h3-0-60" id="h3-0-60" class="d">-echo &quot;$IPADDR&quot; # short text
</a><b>diff --git a/<a id="h4" href="../file/config.stow/.config/i3/scripts/wifi.html">config.stow/.config/i3/scripts/wifi</a> b/<a href="../file/config.stow/.config/i3/scripts/wifi.html">config.stow/.config/i3/scripts/wifi</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,6 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+#!/bin/sh
</a><a href="#h4-0-1" id="h4-0-1" class="i">+
</a><a href="#h4-0-2" id="h4-0-2" class="i">+wifissid=$(nmcli -t -f active,ssid dev wifi | grep &#39;^yes&#39; | cut -d\&#39; -f2 | cut -d: -f2)
</a><a href="#h4-0-3" id="h4-0-3" class="i">+[ -z &quot;$wifissid&quot; ] &amp;&amp; exit;
</a><a href="#h4-0-4" id="h4-0-4" class="i">+
</a><a href="#h4-0-5" id="h4-0-5" class="i">+echo $wifissid
</a><b>diff --git a/<a id="h5" href="../file/config.stow/.profile.html">config.stow/.profile</a> b/<a href="../file/config.stow/.profile.html">config.stow/.profile</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -2,3 +2,4 @@ export QT_QPA_PLATFORMTHEME=&quot;qt5ct&quot;
</a> export EDITOR=&quot;nvim&quot;
 PATH=$PATH:$HOME/.local/bin/; export PATH
 export BROWSER=&quot;firefox&quot;
<a href="#h5-0-3" id="h5-0-3" class="i">+export TERMINAL=&quot;termite&quot;
</a></pre>
</div>
</body>
</html>
